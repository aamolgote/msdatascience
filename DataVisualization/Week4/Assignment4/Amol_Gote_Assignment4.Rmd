---
title: "Assignment 04"
author: "Amol Gote"
date: "2/10/2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(maps)
library(scales)
library(sf)
```

# Question 1
What is happening to price over time (yr_built)
```{r question_1_code, message=FALSE}
houses <- read_csv("data/KING COUNTY House Data.csv")
averagePriceEachYear <- houses %>%
  group_by(yr_built) %>%
  summarise(averagePrice = mean(price))

averagePriceEachYear %>%
  ggplot() +
  geom_point(aes(x = yr_built, y = averagePrice)) +
  geom_smooth(aes(yr_built, averagePrice)) +
  scale_y_continuous(labels = dollar) + labs(x = "Year", y = "Average Price",
  title = "Average price Year on Year",
  subtitle = "Created for Data Visulization Class - Assignment 4 - Question 1",
  caption = "Source: Data Visualization assignment 4") +
  theme_minimal()


# ggplot(data = houses, aes(x = yr_built, y = price)) +
#   stat_summary(fun.y=mean,size=1,geom='line', aes(colour="Mean")) +
#   stat_summary(fun.y=median,size=1,geom='line', aes(colour="Median")) +
#   theme_minimal() +
#   scale_y_continuous(labels = dollar) +
#   labs(x = "Year",
#   y = "Price",
#   title = "Average price Year on Year",
#   subtitle = "Created for Data Visulization Class - Assignment 4 - Question 1",
#   caption = "Source: Data Visualization assignment 4")
  
```
```{r}
#ggplot(data = houses, aes(x = yr_built, y = price)) +
#  stat_summary(fun.y=mean,size=1,geom='line', aes(colour="Mean")) +
#  stat_summary(fun.y=median,size=1,geom='line', aes(colour="Median")) +
#  theme_minimal() +
#  scale_y_continuous(labels = dollar) +
#  labs(x = "Year",
#  y = "Price",
#  title = "Average price Year on Year",
#  subtitle = "Created for Data Visulization Class - Assignment 4 - Question 1",
#  caption = "Source: Data Visualization assignment 4")
```

1. For Comparing price year on year have taken mean and median of house prices for each year built.    
2. Mean and median seems to be following the same pattern. Average price had peaked in early 1900's, have been dropping then till 1950's. Prior to 1950 it had dipped to its minimum number, reason for the same could be World War 2.
3. Post World war 2 it has started rising gradually with a dip around 1970. 
4. Post 1970 it has gradually went up with peaking in 2000 and then again dropping back due to economic depression in 2009. Post that that avarage price has recovered have hit peak, the peak numbers post 2009 are same that of peak number is early 1900's.

# Question 2
What is happening to price over geographic space (Can be lat / long, zipcode, etc)
```{r}
counties <- st_as_sf(map("county", plot = FALSE, fill = TRUE))
counties_wa <-counties %>% 
  filter(str_detect(ID, 'washington,'))

counties_wa_king <- counties_wa %>% 
  filter(str_detect(ID, "king")) 

counties_wa_king %>% 
  ggplot() + 
  geom_sf() +
  geom_point(data = houses, aes(x = long, y = lat, color = price), alpha= .05) +
  #geom_density_2d(data = houses, aes(x = long, y = lat )) +
  scale_colour_viridis_c("Sale Price", limits = c(100000, 1000000), labels = dollar) +
  theme_minimal() + 
  labs(x = "Latitude",
  y = "Longitude",
  title = "King County house prices over geographic space")
```

```{r}
# zipcodeData <- st_read('data/tl_2019_us_zcta510.shp')
# class(zipcodeData)
# head(zipcodeData)
# zipcodeData %>% 
#   ggplot() + 
#   geom_sf() +
#   geom_point(data = houses, aes(x = long, y = lat, color = price), alpha= .05) +
#   scale_colour_viridis_c("Sale Price", labels = dollar) +
#   theme_minimal()
```


```{r}
# counties_wa_king %>% 
#   ggplot() + 
#   geom_sf() +
#   geom_point(data = houses, aes(x = long, y = lat, color = price), alpha= .05) +
#   geom_point(data = zipcodeData, aes(x = long, y = lat, color = price), alpha= .05) +
#   scale_colour_viridis_c("Sale Price", labels = dollar) +
#   theme_minimal() + 
#   labs(x = "Latitude",
#   y = "Longitude",
#   title = "King County house prices over geographic space")
```



# Question 3
What is happening to price over time and space?
```{r}
counties_wa_king %>% 
  ggplot() + 
  geom_sf() +
  geom_point(data = houses, aes(x = long, y = lat, color = price ), alpha= .05) +
  scale_colour_viridis_c("Sale Price", limits = c(100000, 1000000), labels = dollar) +
  facet_wrap(~decade) +
  theme(axis.text.x = element_text(angle =50, hjust=0.75))+ 
  labs(x = "Latitude",
  y = "Longitude",
  title = "King County house prices over time and geographic space")
```


# Question 4
(Extra credit) Try to think about how you can use the zip code data for location information and map price to zipcodes

```{r}
zipcodeShapeData <- st_read('data/tl_2019_us_zcta510.shp')
averagePriceByZipcode <- houses %>%
  group_by(zipcode) %>%
  summarise(averagePrice = mean(price), medianPrice = median(price, na.rm = TRUE))

mergedZipShapeData <- merge(zipcodeShapeData,averagePriceByZipcode,by.x=c("ZCTA5CE10"),by.y=c("zipcode")) 






```

```{r}
zipcodeShapeData <- st_read('data/tl_2019_us_zcta510.shp')
filteredData <- zipcodeShapeData %>%
  filter(zipcodeShapeData$ZCTA5CE10 == '98001')

describe(filteredData)
```

```{r}
zipcodeShapeData <- st_read('data/tl_2019_us_zcta510.shp')
averagePriceByZip <- houses %>% group_by(zipcode) %>% summarize(averagePrice = mean(price, na.rm = TRUE))
mergedShapeAndAvgZipCodeData <- merge(zipcodeShapeData,averagePriceByZip,by.x=c("ZCTA5CE10"),by.y=c("zipcode"))
ggplot(mergedShapeAndAvgZipCodeData) + geom_sf(data=counties_wa_king) + geom_sf(aes(fill=averagePrice)) + scale_fill_viridis_c(option = "plasma", trans = "sqrt") 
```


```{r , message=FALSE}
us_zipcode_shp <- st_read('data/tl_2019_us_zcta510.shp')
houses_zipcode_decade_median <- houses %>% group_by(zipcode,decade) %>% summarize(price_median = median(price, na.rm = TRUE))

us_zipcode_decade_median_price <- merge(us_zipcode_shp,houses_zipcode_decade_median,by.x=c("ZCTA5CE10"),by.y=c("zipcode"))

ggplot(us_zipcode_decade_median_price) + geom_sf(data=counties_wa_king) + geom_sf(aes(fill=price_median)) + scale_fill_viridis_c(option = "plasma", trans = "sqrt") + facet_wrap( ~ decade, ncol=2)

```

```{r , message=FALSE}
# counties_king <- counties_wa %>% 
#   filter(str_detect(ID, "king")) 
# 
# us_zipcode_shp <- st_read('data/tl_2019_us_zcta510.shp')
# houses_zipcode_decade_median <- houses %>% group_by(zipcode,decade) %>% summarize(price_median = median(price, na.rm = TRUE))
# 
# us_zipcode_decade_median_price <- merge(us_zipcode_shp,houses_zipcode_decade_median,by.x=c("ZCTA5CE10"),by.y=c("zipcode"))
# 
# ggplot(us_zipcode_decade_median_price) + geom_sf(data=counties_king) + geom_sf(aes(fill=price_median)) + scale_fill_viridis_c(option = "plasma", trans = "sqrt") + facet_wrap( ~ decade, ncol=2)

```



```{r}
counties_king <- counties_wa %>% 
  filter(str_detect(ID, "king")) 

us_zipcode_shp <- st_read('data/tl_2019_us_zcta510.shp')

houses_zipcode_decade_median <- houses %>% group_by(zipcode,decade) %>% summarize(price_median = median(price, na.rm = TRUE))

us_zipcode_decade_median_price <- merge(us_zipcode_shp,houses_zipcode_decade_median,by.x=c("ZCTA5CE10"),by.y=c("zipcode"))

ggplot(us_zipcode_decade_median_price) + geom_sf(data=counties_king) + geom_sf(aes(fill=price_median)) + scale_fill_viridis_c(option = "plasma", trans = "sqrt") + #facet_wrap( ~ decade, ncol=2)

# mergedZipShapeData %>%
#   ggplot() 
#   + geom_sf() 
#   #+ geom_sf(aes(fill=averagePrice)) 
#   #+ scale_fill_viridis_c(option = "plasma", trans = "sqrt") 
#   #+ facet_wrap( ~ decade, ncol=2)


#houses_zipcode_decade_median <- houses %>% group_by(zipcode,decade) %>% summarize(price_median = median(price, na.rm = TRUE))
#us_zipcode_decade_median_price <- merge(us_zipcode_shp,houses_zipcode_decade_median,by.x=c("ZCTA5CE10"),by.y=c("zipcode")) 
#ggplot(us_zipcode_decade_median_price) + geom_sf(data=counties_king) + geom_sf(aes(fill=price_median)) + scale_fill_viridis_c(option = "plasma", trans = "sqrt") + #facet_wrap( ~ decade, ncol=2)
```