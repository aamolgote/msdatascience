---
title: "Capstone Project - Week1"
author: "Amol Gote"
date: "11/7/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library_setup, MESSAGE = FALSE, warning=FALSE}
set.seed(123)
library(tidyverse)
library(caret)
```


```{r load_data, MESSAGE = FALSE, warning=FALSE}
fundamentals_ds <- read.csv("./data/Fundamentals_DS.csv", na.strings=c(""," "))
nrow(fundamentals_ds)
```



```{r filter_data_datafmt, MESSAGE = FALSE, warning=FALSE}
fundamentals_ds_filter <- fundamentals_ds %>%
  filter(datafmt == 'STD') 
nrow(fundamentals_ds_filter)
```

```{r remove_cols_with_high_na, MESSAGE = FALSE, warning=FALSE}
fundamentals_ds_filter_1 <- fundamentals_ds_filter[ lapply( fundamentals_ds_filter, function(x) sum(is.na(x)) / length(x) ) < 0.1 ]
ncol(fundamentals_ds_filter_1)
```

```{r write_file, MESSAGE = FALSE, warning=FALSE}
write.csv(fundamentals_ds_filter_1, file = "data/fundamentals_ds_filter_1.csv", row.names=FALSE)
```

```{r write_filter_after_na_removal, MESSAGE = FALSE, warning=FALSE}
fundamentals_ds_filter_1 <- fundamentals_ds_filter_1[ lapply( fundamentals_ds_filter_1, function(x) sum(is.na(x)) / length(x) ) < 0.1 ]
fundamentals_ds_filter_1 <- subset(fundamentals_ds_filter_1, select = -c(datadate,indfmt,curncd,consol,popsrc,conm,curcd,apdedate,fdate,add1,addzip,busdesc,
                                                                         city,conml,weburl,phone,loc,final,fyr,acchg,fic,
                                                                         xido,xidoc,naicsh,sich,au,auop,auopic,fyrc,ggroup,gind,gsector,gsubind,priusa))
write.csv(fundamentals_ds_filter_1, file = "data/fundamentals_ds_filter_2.csv", row.names=FALSE, na="")
```

```{r identify_near_zero_variance, MESSAGE = FALSE, warning=FALSE}
nzv_ds <- nearZeroVar(fundamentals_ds_filter_1, saveMetrics = TRUE)
nzv_ds <- nzv_ds[nzv_ds[,"nzv"] > 0, ]
nzv_ds
```



```{r remove_near_zero_variance_columns, MESSAGE = FALSE, warning=FALSE}
nzv_ds_cols <- nearZeroVar(fundamentals_ds_filter_1)
fundamentals_ds_filter_1 <- fundamentals_ds_filter_1[, -nzv_ds_cols]
write.csv(fundamentals_ds_filter_1, file = "data/fundamentals_ds_filter_3.csv", row.names=FALSE, na="")
```

```{r, column_count_after_nzv_removal, MESSAGE = FALSE}
ncol(fundamentals_ds_filter_1)
```


```{r remove_not_required_variables, MESSAGE = FALSE, warning=FALSE }
fundamentals_ds_filter_1 <- subset(fundamentals_ds_filter_1, select = -c(acctstd,ismod,src,acodo,acox,
                                                                          aox,capxv,ceql,cibegni,cicurr,cidergl,
                                                                          cimii,cipen,cisecgl,citotal,cshfd,cshpri,dclo,dcpstk,
                                                                          dltis,dlto,dltr,do,dp,dpvieb,drc,
                                                                          drlt,dv,dvc,epsfx,epspx,exre,
                                                                          fopox,ibadj,ibc,ibcom,ibmii,
                                                                          invch,ivaco,ivaeq,ivao,lco,
                                                                          lcox,lcoxdr,lct,loxdr,mibn,
                                                                          mibt,mii,msa,niadj,np,oprepsx,pnca,ppent,ppeveb,
                                                                          recco,rectr,sale,spced,spceeps,
                                                                          tstkc,txbco,txbcof,txdb,
                                                                          txdba,txdbca,txdc,txdi,
                                                                          txditc,txndb,xopr,exchg,costat,
                                                                          ceoso,cfoso,idbflag,naics,sic,stko))
write.csv(fundamentals_ds_filter_1, file = "data/fundamentals_ds_filter_4.csv", row.names=FALSE, na="")
```

```{r column_count_after_col_removal, MESSAGE = FALSE, warning=FALSE}
ncol(fundamentals_ds_filter_1)
```